# 资源输入输出

## 资源处理流程

一切流程的开始，都需要我们制定一个或多个入口，从这个入口开始，存在依赖关系的模块会被封装为一个**chunk**,由chunk得到打包产物**bundle**。

**chunk**字面意思代码块，在webpack中可以理解成被抽象和包装过后的一些模块。一个工程打包时可能会产生一个或多个chunk

依赖树
![Alt 依赖树](../static/images/webpack/yilaishu.jpg)

entry、chunk、bundle的关系
![Alt 依赖树](../static/images/webpack/entry_chunk_bundle.jpg)

entry和bundle的对应关系
![Alt 依赖树](../static/images/webpack/entry-bundle.jpg)

## 配置资源入口

webpack通过**context**和**entry**这两个配置项来共同决定入口文件路径，配置入口时，实际上做了两件事：
* 确定入口模块位置
* 定义chunk name。如果工程只有一个入口chunk name默认为'main'。

### context 

context,只能是**字符串**，可以理解为资源入口的路径前缀，在配置时必须使用绝对路径的形式
```js
module.exports={
    context:path.join(__dirname,'./src'),
    entry:'./script/index.js'
};
module.exports={
    context:path.join(__dirname,'./src/script'),
    entry:'./index.js'
}
```
context配置可以省略，默认值为当前工程的根目录，适用于多入口情况。

### entry
与context只能为字符串不同，entry的配置可以有多种形式：字符串、数组、对象、函数。

#### 1、字符串类型入口
```js
module.exports={
    entry:'./src/index.js',
    output:{
        filename:'bundle.js'
    },
    mode:'development',
};
```
#### 2、数组类型入口

传入一个数组的作用是将多个资源预先合并，再打包时webpack会将数组中最后一个作为实际的入口文件路径。
```js
module.exports={
    entry:['babel-polyfill','./src/index.js']
}
```
上面的配置相当于
```js
//webpack.config.js
module.exports={
    entry:'./src/index.js'
}

//index.js
import 'babel-polyfill';
```

#### 3、对象类型入口

如果想定义多入口就必须使用对象的形式，对象的属性名(key)是chunkname，属性值(value)是入口路径。
```js
module.exports={
    entry:{
        index:'./src/index.js',
        lib:'./src/lib.js'
    }
}
```
对象的属性值也可以是字符串或数组,如：
```js
module.exports={
    entry:{
        index:['babel-polyfill','./src/index.js'],
        lib:'./src/lib.js'
    }
}
```

#### 4、函数类型入口

用函数定义入口时，只要返回上面任何配置形式即可。
```js
//返回字符串类型
module.exports={
    entry:()=>'./src/index.js'
}

//返回一个对象类型
module.exports={
    entry:()=>({
        index:['babel-polyfill','./src/index.js'],
        lib:'./src/lib.js'
    })
}
```
函数类型的好处就是我们可以在函数体里添加一些**动态**的逻辑来获取工程的入口。也支持返回一个Promise来进行异步操作，例如：
```js
module.exports={
    entry:()=>new Promise((resolve)=>{
        setTimeout(()=>{
            resolve('./src/index.js');
        },1000);
    })
}
```

